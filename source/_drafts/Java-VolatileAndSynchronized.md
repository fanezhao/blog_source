> 在线程并发编程中synchronized和volatile都扮演着重要的角色。

## volatile关键字

在Java语言规范第三版中定义如下：Java编程语言允许访问共享变量，为了确保共享变量能够被准确和一致的更新，线程应该确保通过排他锁单独获得这个变量。

作用：如果一个字段被声明成volatile，Java线程内存模型确保了所有线程看到这个变量是一致的。

#### volatile是如何保证内存可见性的？

有volatile修饰的共享变量的进行写操作的时候，会多出一行lock开头的汇编指令，这个指令会引发两件事情：

- 1、将当前处理器缓存行的内容写回到系统内存。
- 2、这个写回的操作会使其他CPU里缓存了该内存地址的数据无效。

如果对声明了volatile的变量进行写操作，JVM就会向处理器发送一条Lock开头的指令，将这个变量所在的缓存行的数据写回到系统内存。但是，就算写回到内存，如果其他处理器的缓存的值还是旧的，再执行计算操作就会有问题。

所以，在多处理器下，为了保证各个处理器的缓存的一致的，就会实现缓存一致性协议，**每个处理器通过嗅探在总线是传播的数据来检查自己缓存的值是不是过期了**，当处理器发现自己的缓存行对应的内存地址被修改，就会将当前处理器的缓存行设置成无效状态，当处理器对这个数据进行修改的时候，会重新从系统内存中把数据读到处理器的缓存里。

#### volatile是如何防止指令重排序的？



#### volatile总结

1、volatile具有可见性和有序性，不能保证原子性。

2、voaltile在某些特定情况下线程安全，比如自身不做原子操作。